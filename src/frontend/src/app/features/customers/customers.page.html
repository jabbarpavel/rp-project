<div class="page-container">
  <div class="header-bar">
    <div>
      <h2>Kundenverwaltung</h2>
      <p class="customer-count" *ngIf="!loading && !error">
        Anzahl Kunden: {{ filteredCustomers.length }}
      </p>
    </div>
    <button class="add-btn" type="button" (click)="createCustomer()">+ Neuer Kunde</button>
  </div>

  <div class="filter-bar">
    <div class="search-bar">
      <input
        type="text"
        placeholder="Suche nach Kunde oder Berater (Name, E-Mail, AHV)‚Ä¶"
        [(ngModel)]="searchTerm"
        (input)="applyFilter()"
        class="search-input"
      />
    </div>
    <div class="type-filter">
      <button 
        class="filter-btn" 
        [class.active]="typeFilter === 'all'" 
        (click)="setTypeFilter('all')"
      >
        Alle
      </button>
      <button 
        class="filter-btn" 
        [class.active]="typeFilter === 'private'" 
        (click)="setTypeFilter('private')"
      >
        Privatpersonen
      </button>
      <button 
        class="filter-btn" 
        [class.active]="typeFilter === 'org'" 
        (click)="setTypeFilter('org')"
      >
        Organisationen
      </button>
    </div>
  </div>

  <div *ngIf="loading" class="loading">Lade Kunden...</div>
  <div *ngIf="error" class="error">{{ error }}</div>

  <div class="table-wrapper" *ngIf="!loading && !error && filteredCustomers.length > 0">
    <table class="customer-table">
      <thead>
        <tr>
          <th></th>
          <th (click)="sortBy('customerType')">
            Typ
            <span class="sort-icon" *ngIf="sortColumn === 'customerType'">
              {{ sortDirection === 'asc' ? '‚ñ≤' : '‚ñº' }}
            </span>
          </th>
          <th (click)="sortBy('name')">
            Name / Firma
            <span class="sort-icon" *ngIf="sortColumn === 'name'">
              {{ sortDirection === 'asc' ? '‚ñ≤' : '‚ñº' }}
            </span>
          </th>
          <th (click)="sortBy('email')">
            E-Mail
            <span class="sort-icon" *ngIf="sortColumn === 'email'">
              {{ sortDirection === 'asc' ? '‚ñ≤' : '‚ñº' }}
            </span>
          </th>
          <th (click)="sortBy('ahvNum')">
            AHV-Nummer
            <span class="sort-icon" *ngIf="sortColumn === 'ahvNum'">
              {{ sortDirection === 'asc' ? '‚ñ≤' : '‚ñº' }}
            </span>
          </th>
          <th (click)="sortBy('advisorEmail')">
            Berater
            <span class="sort-icon" *ngIf="sortColumn === 'advisorEmail'">
              {{ sortDirection === 'asc' ? '‚ñ≤' : '‚ñº' }}
            </span>
          </th>
          <th (click)="sortBy('createdAt')">
            Erstellt am
            <span class="sort-icon" *ngIf="sortColumn === 'createdAt'">
              {{ sortDirection === 'asc' ? '‚ñ≤' : '‚ñº' }}
            </span>
          </th>
          <th>Aktionen</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let c of filteredCustomers">
          <td class="icon-cell" (click)="viewCustomer(c)">üîç</td>
          <td>
            <span class="type-badge" [class.org]="c.customerType === 1">
              {{ c.customerType === 1 ? 'Organisation' : 'Privatperson' }}
            </span>
          </td>
          <td>{{ getDisplayName(c) }}</td>
          <td>{{ c.email }}</td>
          <td>{{ c.ahvNum }}</td>
          <td>{{ getAdvisorDisplay(c) }}</td>
          <td>{{ c.createdAt | date: 'short' }}</td>
          <td class="actions">
            <button class="btn ghost" type="button" (click)="editCustomer(c)">Bearbeiten</button>
            <button class="btn danger" type="button" (click)="deleteCustomer(c.id)" *ngIf="canDelete">L√∂schen</button>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <p *ngIf="!loading && !error && filteredCustomers.length === 0" class="no-data">
    Keine Kunden gefunden.
  </p>
</div>
